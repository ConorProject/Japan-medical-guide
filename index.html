<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Japan Medical Guide - Medications, Import Rules & Pharmacy Guide</title>
    <meta name="description" content="Complete guide to bringing medications to Japan. Check import restrictions, find pharmacy products, and navigate customs regulations. Updated 2025.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 18px;
            line-height: 1.7;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeInDown 0.8s ease-out;
        }

        .header h1 {
            font-size: 2.8rem;
            font-weight: 600;
            line-height: 1.1;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.3rem;
            font-weight: 400;
            line-height: 1.4;
            opacity: 0.9;
        }

        /* Clean Medical Grade CSS */
        .medication-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .handy-guide {
            padding: 20px;
            font-size: 17px;
            line-height: 1.6;
        }

        .guide-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .medication-title {
            flex: 1;
            min-width: 200px;
        }

        .medication-name {
            font-size: 1.5rem;
            font-weight: 600;
            color: #343a40;
            margin: 0 0 5px 0;
            line-height: 1.2;
        }

        .medication-generic {
            font-size: 1rem;
            color: #6c757d;
            margin-bottom: 3px;
            font-style: italic;
        }

        /* Status Badges - Clean Colors */
        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 12px;
            text-align: center;
            min-width: 120px;
        }

        .status-badge.prohibited {
            background: #dc3545;
            color: white;
        }

        .status-badge.restricted {
            background: #fd7e14;
            color: white;
        }

        .status-badge.permitted {
            background: #28a745;
            color: white;
        }

        /* Card Border Colors */
        .medication-card.status-prohibited {
            border-left: 4px solid #dc3545;
        }

        .medication-card.status-restricted {
            border-left: 4px solid #fd7e14;
        }

        .medication-card.status-permitted {
            border-left: 4px solid #28a745;
        }

        /* Story Hook */
        .story-hook {
            background: #e3f2fd;
            border: 1px solid #90caf9;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .hook-text {
            font-size: 0.95rem;
            line-height: 1.5;
            color: #1565c0;
            font-weight: 500;
            margin: 0;
        }

        /* Critical Action */
        .critical-action {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-left: 3px solid #1976d2;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 15px;
        }

        .action-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1976d2;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .action-steps {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .step-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: 4px;
            border: 1px solid #e9ecef;
        }

        .step-number {
            background: #1976d2;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .step-content {
            font-size: 0.95rem;
            line-height: 1.4;
            color: #495057;
            font-weight: 500;
        }

        /* Quick Facts */
        .quick-facts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .fact-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 4px;
            border: 1px solid #e9ecef;
            border-left: 3px solid #1976d2;
        }

        .fact-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .fact-value {
            font-size: 0.9rem;
            font-weight: 600;
            color: #343a40;
            line-height: 1.2;
        }

        /* Encyclopedia Toggle */
        .encyclopedia-toggle {
            width: 100%;
            padding: 12px 20px;
            background: #1976d2;
            color: white;
            border: none;
            border-radius: 6px;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .encyclopedia-toggle:hover {
            background: #1565c0;
        }

        /* Encyclopedia Section */
        .encyclopedia {
            display: none;
            padding: 0 20px 20px 20px;
            border-top: 1px solid #e0e0e0;
            background: #fafafa;
        }

        .encyclopedia.expanded {
            display: block;
        }

        .encyclopedia-header {
            font-size: 1.3rem;
            font-weight: 600;
            color: #1565c0;
            margin-bottom: 20px;
            padding-top: 20px;
            text-align: center;
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 12px;
        }

        /* Chart Sections */
        .chart-section {
            background: white;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
        }

        .chart-section h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1565c0;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Search Section */
        .search-section {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            color: white;
            text-align: center;
        }

        .search-section h2 {
            margin: 0 0 10px 0;
            font-size: 2rem;
        }

        .search-section p {
            margin: 0 0 20px 0;
            opacity: 0.9;
        }

        .search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 50px;
            font-size: 17px;
            outline: none;
            transition: all 0.3s ease;
            background: white;
            color: #333;
        }

        .search-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-btn {
            padding: 15px 30px;
            background: white;
            color: #667eea;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        /* Category overview */
        .category-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .category-card {
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .category-card h3 {
            font-size: 1.4rem;
            margin-bottom: 10px;
        }

        .category-card p {
            margin-bottom: 15px;
        }

        .category-prohibited {
            background: #f8d7da;
            border: 2px solid #dc3545;
        }

        .category-prohibited h3,
        .category-prohibited p {
            color: #721c24;
        }

        .category-restricted {
            background: #fff3cd;
            border: 2px solid #856404;
        }

        .category-restricted h3,
        .category-restricted p {
            color: #856404;
        }

        .category-permitted {
            background: #d4edda;
            border: 2px solid #155724;
        }

        .category-permitted h3,
        .category-permitted p {
            color: #155724;
        }

        .med-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .med-button {
            background: white;
            border: 1px solid currentColor;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .med-button:hover {
            background: currentColor;
            color: white !important;
        }

        /* Results Grid */
        .results-grid {
            display: grid;
            gap: 20px;
        }

        .no-results {
            text-align: center;
            color: #666;
            font-size: 1.2rem;
            margin-top: 50px;
            padding: 40px;
            background: rgba(255,255,255,0.9);
            border-radius: 20px;
            display: none;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            body {
                font-size: 16px;
            }

            .header h1 {
                font-size: 2.2rem;
            }

            .header p {
                font-size: 1.1rem;
            }

            .medication-name {
                font-size: 1.3rem;
            }

            .search-bar {
                flex-direction: column;
            }

            .guide-header {
                flex-direction: column;
                align-items: stretch;
            }

            .status-badge {
                width: 100%;
            }

            .quick-facts {
                grid-template-columns: 1fr;
            }

            .category-overview {
                grid-template-columns: 1fr;
            }
        }

        /* Animations */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        /* Enhanced Encyclopedia Styling for Better Readability */

/* Encyclopedia Section */
.encyclopedia {
    display: none;
    padding: 30px;
    border-top: 1px solid #e0e0e0;
    background: #fafafa;
    line-height: 1.6;
}

.encyclopedia.expanded {
    display: block;
}

.encyclopedia-header {
    font-size: 1.4rem;
    font-weight: 600;
    color: #1565c0;
    margin-bottom: 30px;
    padding-bottom: 15px;
    text-align: center;
    border-bottom: 2px solid #dee2e6;
}

/* Chart Sections - Much Better Spacing */
.chart-section {
    background: white;
    border-radius: 8px;
    padding: 25px;
    margin-bottom: 25px;
    border: 1px solid #e0e0e0;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.chart-section h4 {
    font-size: 1.2rem;
    font-weight: 600;
    color: #1565c0;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
    border-bottom: 1px solid #e9ecef;
    padding-bottom: 10px;
}

/* Insight Boxes - Special Styling */
.insight-box {
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    border-left: 4px solid;
    font-size: 1rem;
    line-height: 1.6;
}

.insight-box strong {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.insight-key {
    background: #e3f2fd;
    border-left-color: #1976d2;
    color: #1565c0;
}

.insight-cultural {
    background: #f3e5f5;
    border-left-color: #7b1fa2;
    color: #6a1b9a;
}

.insight-misconception {
    background: #fff3e0;
    border-left-color: #f57c00;
    color: #ef6c00;
}

/* Commentary Section Improvements */
.commentary-section {
    margin-bottom: 30px;
}

.commentary-header {
    font-size: 1.3rem;
    font-weight: 600;
    color: white;
    margin-bottom: 20px;
    text-align: center;
    padding: 15px;
    background: linear-gradient(135deg, #1976d2, #1565c0);
    border-radius: 8px;
}

.commentary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.commentary-item {
    background: white;
    border-radius: 8px;
    padding: 25px;
    border: 1px solid #e0e0e0;
    border-left: 4px solid #1976d2;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.commentary-item h5 {
    font-size: 1.1rem;
    font-weight: 600;
    color: #1565c0;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
    border-bottom: 1px solid #e9ecef;
    padding-bottom: 8px;
}

/* Better List Styling */
.commentary-item p {
    font-size: 0.95rem;
    line-height: 1.6;
    color: #495057;
    margin-bottom: 12px;
    padding-left: 0;
}

.commentary-item p:last-child {
    margin-bottom: 0;
}

/* Bullet Point Improvements */
.commentary-item div {
    margin-left: 0;
}

.commentary-item div p {
    position: relative;
    padding-left: 20px;
    margin-bottom: 10px;
}

.commentary-item div p:before {
    content: "•";
    color: #1976d2;
    font-weight: 600;
    position: absolute;
    left: 0;
    top: 0;
}

/* Chart Grid Improvements */
.chart-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}

.chart-item {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 6px;
    border: 1px solid #e9ecef;
    border-left: 4px solid #1976d2;
    transition: transform 0.2s ease;
}

.chart-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.chart-label {
    font-size: 0.75rem;
    font-weight: 600;
    color: #6c757d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 6px;
}

.chart-value {
    font-size: 0.95rem;
    font-weight: 600;
    color: #343a40;
    line-height: 1.3;
}

/* Special Sections Styling */
.alternatives-section {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    border-left: 4px solid #28a745;
}

.alternatives-section p {
    font-size: 0.95rem;
    line-height: 1.6;
    color: #495057;
    margin-bottom: 8px;
    position: relative;
    padding-left: 20px;
}

.alternatives-section p:before {
    content: "→";
    color: #28a745;
    font-weight: 600;
    position: absolute;
    left: 0;
    top: 0;
}

/* Research Quality Section */
.research-quality-section {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    border-radius: 8px;
    padding: 20px;
    border: 1px solid #dee2e6;
}

/* Mobile Responsive for Encyclopedia */
@media (max-width: 768px) {
    .encyclopedia {
        padding: 20px;
    }
    
    .chart-section {
        padding: 20px;
        margin-bottom: 20px;
    }
    
    .commentary-grid {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .commentary-item {
        padding: 20px;
    }
    
    .chart-grid {
        grid-template-columns: 1fr;
    }
    
    .encyclopedia-header {
        font-size: 1.2rem;
        margin-bottom: 25px;
    }
    /* Unified restricted status styling */
.status-badge.restricted {
  background-color: #e67e22 !important;
  color: #fff !important;
}
.medication-card.status-restricted {
  border-left: 4px solid #e67e22 !important;
}
}

/* ============================================================================ */
/* NEW CSS STYLES FOR ENHANCED CLASSIFICATION SYSTEM */
/* ============================================================================ */

/* Threshold-based medication styling */
.threshold-info {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 15px;
    margin: 15px 0;
}

.threshold-title {
    font-weight: bold;
    margin-bottom: 10px;
    color: #495057;
}

.threshold-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
}

.threshold-item {
    padding: 10px;
    border-radius: 6px;
    text-align: center;
}

.threshold-item.permitted {
    background: #d4edda;
    border: 1px solid #c3e6cb;
}

.threshold-item.restricted {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
}

.threshold-status {
    font-weight: bold;
    margin-bottom: 5px;
}

.threshold-limit, .threshold-trigger {
    font-size: 0.9em;
    margin-bottom: 3px;
}

.threshold-note {
    font-size: 0.8em;
    color: #6c757d;
}

/* Customs guidance styling */
.customs-guidance {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 15px;
    margin: 15px 0;
}

.guidance-title {
    font-weight: bold;
    margin-bottom: 10px;
    color: #495057;
}

.guidance-tabs {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

.guidance-tab.legal {
    background: #e3f2fd;
    border: 1px solid #bbdefb;
    border-radius: 6px;
    padding: 10px;
}

.guidance-tab.recommended {
    background: #f3e5f5;
    border: 1px solid #e1bee7;
    border-radius: 6px;
    padding: 10px;
}

.guidance-tab h5 {
    margin: 0 0 8px 0;
    font-size: 0.9em;
}

.guidance-item {
    margin-bottom: 5px;
    font-size: 0.85em;
}

.guidance-item strong {
    font-weight: 600;
}

/* Status badge updates for new system */
.status-badge.threshold-based {
    background: linear-gradient(135deg, #28a745, #ffc107);
    color: white;
}

/* Mobile responsiveness for new elements */
@media (max-width: 768px) {
    .threshold-grid,
    .guidance-tabs {
        grid-template-columns: 1fr;
    }
    
    .threshold-item,
    .guidance-tab {
        margin-bottom: 10px;
    }
}

/* Classification Info Modal Styles */
.info-button {
    background: #1976d2;
    color: white;
    border: none;
    border-radius: 20px;
    padding: 8px 16px;
    font-size: 0.9rem;
    cursor: pointer;
    margin: 10px auto;
    display: block;
    transition: background-color 0.2s ease;
}

.info-button:hover {
    background: #1565c0;
}

.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
}

.modal-content {
    background-color: white;
    margin: 5% auto;
    padding: 30px;
    border-radius: 12px;
    width: 90%;
    max-width: 700px;
    max-height: 80vh;
    overflow-y: auto;
    position: relative;
}

.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    position: absolute;
    right: 20px;
    top: 15px;
}

.close:hover,
.close:focus {
    color: black;
}

.classification-item {
    margin-bottom: 25px;
    padding: 20px;
    border-radius: 8px;
    border-left: 4px solid;
}

.classification-prohibited {
    background: #f8d7da;
    border-left-color: #dc3545;
}

.classification-restricted {
    background: #fff3cd;
    border-left-color: #e67e22;
}

.classification-permitted {
    background: #d4edda;
    border-left-color: #28a745;
}

.classification-title {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 10px;
}

.classification-description {
    line-height: 1.6;
    margin-bottom: 10px;
}

.classification-example {
    font-style: italic;
    font-size: 0.9rem;
    color: #666;
}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏥 Japan Medical Guide</h1>
            <p>Your complete guide to bringing medications to Japan safely and legally</p>
        </div>

        <!-- Import Status Checker -->
        <div class="search-section">
            <h2>🔍 Check Your Medication Import Status</h2>
            <p>Instant answers: Is your medication prohibited, restricted, or permitted in Japan?</p>
            
            <button class="info-button" onclick="openClassificationModal()">
                ℹ️ How Our Classification System Works
            </button>
            
            <div class="search-bar">
                <input type="text" 
                       class="search-input" 
                       placeholder="Enter medication name (e.g., Adderall, Birth Control, Tylenol)..." 
                       id="medicationSearch"
                       onkeypress="if(event.key==='Enter') searchMedications()">
                <button class="search-btn" onclick="searchMedications()">
                    Check Status
                </button>
            </div>
        </div>
        <div id="searchResults"></div>

        <!-- Search Results Area -->
        <div id="resultsArea">
            <!-- Category Overview -->
            <div class="category-overview" id="categoryOverview">
                <div class="category-card category-prohibited">
                    <h3>❌ Prohibited (2)</h3>
                    <p>Cannot enter Japan under any circumstances</p>
                    <div class="med-buttons">
                        <button class="med-button" style="color: #dc3545;" onclick="searchSpecific('Adderall')">Adderall</button>
                        <button class="med-button" style="color: #dc3545;" onclick="searchSpecific('Sudafed')">Sudafed</button>
                    </div>
                </div>

                <div class="category-card category-restricted">
                    <h3>⚠️ Restricted (4)</h3>
                    <p>Requires permits or customs declaration</p>
                    <div class="med-buttons">
                        <button class="med-button" style="color: #856404;" onclick="searchSpecific('Vyvanse')">Vyvanse</button>
                        <button class="med-button" style="color: #856404;" onclick="searchSpecific('Concerta')">Concerta</button>
                        <button class="med-button" style="color: #856404;" onclick="searchSpecific('Clonazepam')">Clonazepam</button>
                        <button class="med-button" style="color: #856404;" onclick="searchSpecific('EpiPen')">EpiPen</button>
                    </div>
                </div>

                <div class="category-card category-permitted">
                    <h3>✅ Permitted (2)</h3>
                    <p>Allowed with standard requirements</p>
                    <div class="med-buttons">
                        <button class="med-button" style="color: #155724;" onclick="searchSpecific('Birth Control')">Birth Control</button>
                        <button class="med-button" style="color: #155724;" onclick="searchSpecific('Tramadol')">Tramadol</button>
                    </div>
                </div>
            </div>

            <!-- Search Results -->
            <div class="results-grid" id="searchResults"></div>
            

            <!-- No Results Message -->
            <div class="no-results" id="noResults">
                No medication found. Try searching by generic name or active ingredient.
            </div>
        </div>
    </div>

    <script>
        // Clean medication database with 3-category system
        const medications = [
            // PROHIBITED
            {
                "name": "Adderall",
                "genericName": "amphetamine/dextroamphetamine mixed salts",
                "alternateNames": ["Adderall XR", "Mixed amphetamine salts", "Mydayis"],
                "status": "prohibited",
                "category": "Stimulants (ADHD)",
                
                // Simple prohibited structure - no thresholds needed
                "maxQuantity": "ZERO - Completely prohibited under Stimulants Control Act",
                "conditions": "Illegal to possess in Japan - no exceptions",
                "permitRequired": "Cannot obtain permit - amphetamine is classified as illegal stimulant",
                "consequences": "Immediate arrest, 20+ day detention, deportation, permanent criminal record",
                "alternatives": ["Vyvanse (with advance permit)", "Concerta (with advance permit)", "Strattera (available in Japan)"],
                "searchTerms": ["adderall", "amphetamine", "dextroamphetamine", "adhd", "mydayis", "mixed salts"],
                "customsDeclaration": "ILLEGAL - will be confiscated",
                "channelRequired": "Immediate detention if discovered",
                
                // Story elements - focused and factual for prohibited drug
                "uniqueStory": "The ADHD medication that's completely banned while chemically similar Vyvanse can be imported with permits",
                "culturalContext": "Japan's zero-tolerance approach to amphetamines stems from historical stimulant abuse issues in the post-war period",
                "commonMisconception": "That all ADHD medications are treated equally - Adderall is uniquely prohibited while others require permits",
                "surpriseFactor": "Documented cases show 23-day detention periods and permanent deportation for a single bottle of pills",
                
                // Minimal commentary for prohibited substances
                "commentary": {
                    "storyHook": "The one ADHD medication that guarantees arrest in Japan.",
                    "practicalTips": [
                        "Switch to Vyvanse or Concerta before travel (4-6 weeks permit process)",
                        "Consult doctor about Strattera - available in Japan without permits",
                        "Never attempt to bring even a single pill - zero tolerance enforcement"
                    ],
                    "warningFlags": [
                        "20 police officers, immediate arrest, 23-day average detention",
                        "Permanent criminal record and entry ban to Japan",
                        "No humanitarian exceptions - documented enforcement cases"
                    ]
                },

                "japanAvailability": {
                    "prescriptionRequired": false,
                    "costRange": "Not available - illegal substance",
                    "insuranceCoverage": "Not applicable - prohibited",
                    "availableBrands": [],
                    "restrictions": "Completely banned under Stimulants Control Act",
                    "alternativeOptions": "Strattera (atomoxetine) available by prescription; Vyvanse/Concerta with permits"
                },

                "importDetails": {
                    "customsDeclaration": "ILLEGAL - immediate confiscation",
                    "channelRequired": "Red Channel (detention/arrest)",
                    "documentationNeeded": ["No documentation can legalize this substance"],
                    "quantityLimits": "Zero tolerance - any amount illegal",
                    "permitProcess": "No permit process exists - substance is prohibited"
                },

                "researchQuality": {
                    "primarySources": [
                        "MHLW Stimulants Control Act (official)",
                        "Japan NCD controlled substances list",
                        "Embassy warnings (US, UK, AU, CA)"
                    ],
                    "communityValidation": [
                        "Documented detention cases (Carrie Russell, 2019)",
                        "Consistent embassy warnings",
                        "Zero successful import cases found"
                    ],
                    "lastUpdated": "2025-01-15",
                    "confidenceLevel": "Absolute - legal certainty from primary sources"
                }
            },

            {
                name: "Sudafed",
                genericName: "pseudoephedrine",
                status: "prohibited",
                category: "Decongestants",
                maxQuantity: "ZERO - Completely prohibited", 
                conditions: "Illegal stimulant precursor in Japan",
                notes: "Pseudoephedrine is banned in Japan as stimulant precursor. Use phenylephrine alternatives instead.",
                permitRequired: "Cannot obtain permit - substance is banned",
                consequences: "Confiscation at customs, possible detention",
                alternatives: ["Pabron (Japanese decongestant)", "Phenylephrine-based alternatives"],
                searchTerms: ["sudafed", "pseudoephedrine", "decongestant", "cold medicine"],
                customsDeclaration: "ILLEGAL - will be confiscated",
                channelRequired: "Will be stopped at customs"
            },

            // RESTRICTED
            {
                name: "Vyvanse",
                genericName: "lisdexamfetamine",
                status: "restricted",
                category: "ADHD Medication",
                maxQuantity: "30 days supply with permit only",
                conditions: "Import permit required 4-6 weeks before travel. Must declare at Red Channel.",
                notes: "Requires Narcotic/Psychotropic Import Certificate. Processing takes 2-4 weeks minimum.",
                permitRequired: "YES - Import certificate required 4-6 weeks before travel",
                consequences: "Confiscation without permit. Detention possible.",
                alternatives: ["Concerta (also needs permit)", "Strattera (available in Japan)"],
                searchTerms: ["vyvanse", "lisdexamfetamine", "adhd", "elvanse"],
                customsDeclaration: "Required - Red Channel",
                channelRequired: "Red Channel - must declare"
            },

            {
                name: "Concerta",
                genericName: "methylphenidate",
                status: "restricted",
                category: "ADHD Medication", 
                maxQuantity: "30 days supply with permit only",
                conditions: "Import permit required 4-6 weeks before travel. Must declare at Red Channel.",
                notes: "Available in Japan by prescription. Requires import permit for personal medication.",
                permitRequired: "YES - Import certificate required 4-6 weeks before travel",
                consequences: "Confiscation without permit. Possible detention.",
                alternatives: ["Switch to Japanese prescription", "Strattera (available in Japan)"],
                searchTerms: ["concerta", "methylphenidate", "ritalin", "adhd"],
                customsDeclaration: "Required - Red Channel", 
                channelRequired: "Red Channel - must declare"
            },

            {
                name: "Clonazepam",
                genericName: "clonazepam",
                status: "restricted",
                category: "Benzodiazepine",
                mhlwPsychotropicList: true,
                maxQuantity: "ANY quantity requires permit - no threshold exemption",
                conditions: "Import permit required for ANY amount. Must declare at Red Channel.",
                notes: "Unlike other benzodiazepines, clonazepam has NO quantity exemption. Even 1 pill requires permit.",
                permitRequired: "YES - Required for any quantity (unique among benzos)",
                consequences: "Confiscation without permit. Treated as illegal import.",
                alternatives: ["Diazepam (under 1.2g allowed)", "Switch to Japanese anxiety medication"],
                searchTerms: ["clonazepam", "klonopin", "rivotril", "anxiety"],
                customsDeclaration: "Required - Red Channel",
                channelRequired: "Red Channel - must declare",
                uniqueStory: "The only benzodiazepine with ZERO quantity tolerance - even one pill needs a permit"
            },

            {
                name: "EpiPen",
                genericName: "epinephrine auto-injector",
                status: "restricted",
                category: "Emergency Medication",
                maxQuantity: "Up to 2 devices with prescription",
                conditions: "Must declare at Red Channel. Keep prescription and doctor's letter ready.",
                notes: "Injectable device requires declaration. Available in Japan for ¥7,800-12,000. Widely recognized by customs.",
                permitRequired: "Not required for reasonable quantities with prescription",
                consequences: "Confiscation if not declared properly",
                alternatives: ["Purchase in Japan (expensive)", "Get doctor's letter"],
                searchTerms: ["epipen", "epinephrine", "allergy", "anaphylaxis", "emergency"],
                customsDeclaration: "Required - Red Channel",
                channelRequired: "Red Channel - must declare device"
            },

            // PERMITTED
            {
                "name": "Birth Control Pills",
                "genericName": "various oral contraceptives (estrogen/progestin combinations)",
                "alternateNames": [
                    "The Pill", "Oral contraceptives", "Combined pill", "Mini-pill", 
                    "Yaz", "Yasmin", "Ortho Tri-Cyclen", "Lo Loestrin", "Seasonique",
                    "Marvelon", "Triquilar", "Microgynon", "Diane-35", "Cerazette"
                ],
                "status": "permitted",
                "category": "Contraceptives",
                
                // Enhanced customs guidance from unified template
                "customsDeclaration": {
                    "legal": {
                        "formDeclaration": "Not required for 1-month supplies",
                        "channel": "Green Channel (no declaration needed)",
                        "verbalRequirement": "Only if specifically asked by officer"
                    },
                    "recommended": {
                        "formDeclaration": "Not necessary for typical travelers",
                        "channel": "Green Channel - proceed normally",
                        "verbalApproach": "If questioned: 'I have prescription medication with proper documentation'",
                        "reasoning": "Birth control is explicitly mentioned as permitted by multiple official sources"
                    }
                },
                
                "maxQuantity": "1 month supply (21-28 pills) without permit. Larger quantities require Yunyu Kakunin-sho",
                "conditions": "Keep in original prescription bottle with pharmacy label clearly showing your name and prescribing doctor",
                "notes": "Explicitly listed as permitted medication by US Embassy, Kansai Gaidai, and MHLW guidance. Easier to import than obtain locally due to Japan's limited availability and high costs",
                "permitRequired": "Not required for 1-month supply. Yunyu Kakunin-sho required for larger quantities (apply 2-3 weeks in advance)",
                "consequences": "No special issues - standard permitted medication",
                "alternatives": [
                    "Japanese prescription options (limited brands, ¥2,000-3,500/month)", 
                    "Mail delivery services for extended stays",
                    "Online consultation services for English speakers"
                ],
                "searchTerms": [
                    "birth control", "contraceptive", "pill", "yaz", "ortho", "yasmin", 
                    "oral contraceptive", "hormone", "estrogen", "progestin", "mini pill", 
                    "contraception", "family planning", "piru"
                ],
                "channelRequired": "Green Channel",

                // Enhanced story elements with compelling narrative
                "uniqueStory": "The contraceptive access paradox: easier to import than to obtain locally, with limited availability despite legal status",
                "culturalContext": "Japan's contraceptive pill approval followed a unique regulatory timeline, with legalization occurring in 1999. The country's approach emphasizes traditional contraceptive methods and careful evaluation of new pharmaceutical options",
                "commonMisconception": "That birth control pills are widely available and affordable in Japan. Reality: only 0.9-3% usage rate, expensive (¥2,000-3,500/month), no insurance coverage, monthly doctor visits required",
                "surpriseFactor": "Despite being legal since 1999, 80% of Japanese couples still prefer condoms, and some Japanese women travel to South Korea for easier contraceptive access",
            
                "commentary": {
                    "storyHook": "The contraceptive choice paradox: easier to import than to buy locally in Japan.",
                    
                    "practicalTips": [
                        "Pack in original prescription bottles with clear pharmacy labels showing your name",
                        "Bring prescription copy as backup documentation",
                        "For stays over 1 month, apply for Yunyu Kakunin-sho 2-3 weeks before travel",
                        "Consider mail delivery services for extended stays rather than switching to Japanese brands",
                        "Budget ¥2,000-3,500/month if obtaining pills in Japan"
                    ],
                    
                    "commonMistakes": [
                        "Assuming Japanese birth control pills are the same formulations as home country",
                        "Not researching mail delivery options for long-term stays",
                        "Expecting insurance coverage for contraceptive use",
                        "Not bringing sufficient supply for extended visits"
                    ],
                    
                    "realWorldInsights": [
                        "Most prescription drugs are permitted, including medicines that may not be available in Japan, such as birth control pills (Kansai Gaidai University guidance)",
                        "Travelers consistently report successful entry with 1-month supplies",
                        "Japanese women often travel to South Korea for easier birth control access",
                        "Mini-pills (progesterone-only) remain unavailable in Japan as of 2025"
                    ],
                    
                    "proTips": [
                        "Research online consultation services for long-term stays - some clinics now offer English-language telehealth",
                        "If staying over 6 months, investigate mail delivery from home country pharmacy",
                        "Japanese doctors may require monthly visits rather than quarterly refills",
                        "Consider switching to long-acting methods (IUD) before travel if planning extended stay"
                    ],
                    
                    "warningFlags": [
                        "Don't attempt to bring more than 3-month supply without proper permits",
                        "Ensure prescription bottles clearly show your name - customs may verify",
                        "Be prepared for higher costs and different formulations if switching to Japanese brands"
                    ]
                },
            
                "importDetails": {
                    "customsDeclaration": "Not required for standard amounts",
                    "channelRequired": "Green Channel (no goods to declare)",
                    "documentationNeeded": [
                        "Original prescription bottle with pharmacy label",
                        "Prescription copy (recommended)",
                        "Doctor's letter (helpful but not required)"
                    ],
                    "quantityLimits": "Up to 1 month supply without permits",
                    "permitProcess": "Yunyu Kakunin-sho for quantities over 1 month - apply to Regional Health Bureau 2-3 weeks in advance"
                },
            
                "japanAvailability": {
                    "prescriptionRequired": true,
                    "costRange": "¥2,000-3,500 per month",
                    "insuranceCoverage": "Not covered unless for medical conditions (endometriosis, heavy periods)",
                    "availableBrands": [
                        "Triquilar (triphasic)",
                        "Diane-35", 
                        "Microgynon",
                        "Marvelon",
                        "Various low-dose formulations"
                    ],
                    "restrictions": "Monthly doctor visits required, regular blood tests, mini-pills not available",
                    "alternativeOptions": "Online consultation services emerging for English speakers"
                },
            
                "researchQuality": {
                    "primarySources": [
                        "MHLW Q&A for importing medicines (official)",
                        "Kansai Gaidai University guidance",
                        "US Embassy medication guidance"
                    ],
                    "communityValidation": [
                        "Multiple travel guides confirm 1-month import allowance",
                        "Expat communities report successful imports",
                        "Academic research on Japan's birth control timeline"
                    ],
                    "lastUpdated": "2025-01-15",
                    "confidenceLevel": "High - backed by official sources and traveler experiences"
                }
            },

            {
                "name": "Xanax (Alprazolam)",
                "genericName": "alprazolam",
                "alternateNames": ["Xanax", "Xanax XR", "Alprazolam", "Niravam"],
                "status": "restricted",
                "category": "Benzodiazepines (Anxiety)",
                "mhlwPsychotropicList": true,
                
                // Psychotropic medication - Red Channel required regardless of quantity
                "maxQuantity": "≤72mg no permit needed, >72mg requires advance permit",
                "conditions": "Must declare at Red Channel regardless of quantity (psychotropic substance)",
                
                // Mandatory declaration for all psychotropics (Tokyo Customs guidance)
                "customsDeclaration": {
                    "legal": {
                        "formDeclaration": "REQUIRED - mark Yes on customs form regardless of quantity",
                        "channel": "Red Channel - mandatory for all psychotropics",
                        "verbalRequirement": "Must proceed to manned inspection desk"
                    },
                    "recommended": {
                        "formDeclaration": "Required by Tokyo Customs directive",
                        "channel": "Red Channel - no exceptions for psychotropics",
                        "verbalApproach": "I am declaring psychotropic medication with proper prescription",
                        "reasoning": "Official Tokyo Customs guidance requires declaration of all psychotropics"
                    }
                },
                
                "permitRequired": "Not required for ≤72mg. Yunyu Kakunin-sho required for >72mg (apply 14+ days in advance)",
                "consequences": "Confiscation if not declared; permit required for >72mg",
                "alternatives": ["Other benzodiazepines with higher thresholds", "Switch to Japanese alternatives"],
                "searchTerms": ["xanax", "alprazolam", "anxiety", "panic", "benzodiazepine", "benzo"],
                "channelRequired": "Red Channel - mandatory for psychotropics",
                
                // Story elements - focused on the threshold paradox
                "uniqueStory": "The anxiety medication with the strictest threshold - easier to exceed the 72mg limit than other benzos",
                "culturalContext": "Japan's psychotropic regulations set different quantity limits for each specific medication, not blanket rules",
                "commonMisconception": "That all benzodiazepines have the same import limits - alprazolam has a much lower threshold than clonazepam",
                "surpriseFactor": "At 72mg total, Xanax travelers often need permits where Klonopin users don't - check your specific medication",
                
                "commentary": {
                    "storyHook": "The anxiety medication where dosage math matters most.",
                    "practicalTips": [
                        "Calculate total mg: 0.5mg x 144 tablets = 72mg (exactly at limit)",
                        "Higher doses like 2mg tablets hit the limit quickly (36 tablets = 1 month)",
                        "Consider switching to clonazepam before travel (180mg threshold)",
                        "Apply for permit if you need more than 1-2 months supply"
                    ],
                    "commonMistakes": [
                        "Not calculating total milligrams before travel",
                        "Assuming same rules as other anxiety medications",
                        "Bringing extended release plus immediate release forms"
                    ],
                    "realWorldInsights": [
                        "Most 0.25mg users can bring 3+ months without permits",
                        "1mg+ users typically need permits for longer trips",
                        "Customs may count all benzodiazepines together"
                    ],
                    "warningFlags": [
                        "Check total milligrams across all forms and strengths",
                        "Don't combine with other benzodiazepines without checking totals",
                        "Higher potency = faster threshold crossing"
                    ]
                },

                "japanAvailability": {
                    "prescriptionRequired": true,
                    "costRange": "¥500-1,500 per month",
                    "insuranceCoverage": "Covered under national health insurance",
                    "availableBrands": ["Alprazolam (generic)", "Constan", "Solanax"],
                    "restrictions": "Regular psychiatric consultation required, controlled substance monitoring",
                    "alternativeOptions": "Other benzodiazepines available (lorazepam, etizolam)"
                },

                "importDetails": {
                    "customsDeclaration": "REQUIRED - all psychotropics must be declared",
                    "channelRequired": "Red Channel - mandatory for psychotropics",
                    "documentationNeeded": [
                        "Original prescription bottle with pharmacy label",
                        "Doctor's letter explaining medical necessity", 
                        "Prescription copy"
                    ],
                    "quantityLimits": "≤72mg no permit needed, >72mg requires advance permit",
                    "permitProcess": "Yunyu Kakunin-sho via Regional Health Bureau (14+ days processing)"
                },

                "researchQuality": {
                    "primarySources": [
                        "MHLW psychotropic substances list",
                        "Tokyo Customs email directive (2025)",
                        "Official customs declaration form guidance"
                    ],
                    "communityValidation": [
                        "Direct correspondence with Tokyo Customs",
                        "Embassy guidance consistent with customs requirements",
                        "Official directive supersedes anecdotal reports"
                    ],
                    "lastUpdated": "2025-01-15",
                    "confidenceLevel": "Absolute - direct customs authority guidance"
                }
            },
                        
            {
                name: "Tramadol",
                genericName: "tramadol",
                status: "permitted",
                category: "Pain Relief",
                maxQuantity: "2 months supply (60 days)",
                conditions: "Keep in original packaging with prescription",
                notes: "Surprisingly, tramadol is NOT controlled in Japan despite being regulated in many countries. Easy import.",
                permitRequired: "Not required",
                consequences: "No special issues",
                alternatives: ["Available in Japan by prescription"],
                searchTerms: ["tramadol", "ultram", "pain relief", "conzip"],
                customsDeclaration: "Not required",
                channelRequired: "Green Channel",
                uniqueStory: "Tramadol is NOT controlled in Japan despite being regulated as an opioid in many Western countries"
            }
        ];


// --- MAIN SEARCH FUNCTION ---
function searchMedications() {
    const searchTerm = document.getElementById('medicationSearch').value.toLowerCase().trim();
    const resultsGrid = document.getElementById('searchResults');
    const categoryOverview = document.getElementById('categoryOverview');
    const noResults = document.getElementById('noResults');

    if (!searchTerm) {
        // Show overview, hide results and no-results
        categoryOverview.style.display = 'grid';
        resultsGrid.innerHTML = '';
        resultsGrid.style.display = 'none';
        noResults.style.display = 'none';
        return;
    }

    // Hide overview, show results grid
    categoryOverview.style.display = 'none';
    resultsGrid.style.display = 'grid';

    // Filter meds by name, genericName, or any searchTerm
    const results = medications.filter(med => {
        return med.name.toLowerCase().includes(searchTerm) ||
               (med.genericName && med.genericName.toLowerCase().includes(searchTerm)) ||
               (med.searchTerms && med.searchTerms.some(term => term.includes(searchTerm)));
    });

    if (results.length === 0) {
        resultsGrid.innerHTML = '';
        noResults.style.display = 'block';
        return;
    }

    noResults.style.display = 'none';
    displayRestrictionResults(results);
}

// --- CATEGORY BUTTON SEARCH ---
function searchSpecific(medicationName) {
    document.getElementById('medicationSearch').value = medicationName;
    searchMedications();
}

// --- ENHANCED RESTRICTION RESULTS DISPLAY ---
function displayRestrictionResults(results) {
    const resultsGrid = document.getElementById('searchResults');
    resultsGrid.innerHTML = results.map(med => {
        // Determine primary status and styling
        let statusIcon, statusClass, statusText;
        
        // Handle threshold-based medications
        if (med.regulatoryThresholds) {
            statusIcon = '⚖️';
            statusClass = 'threshold-based';
            statusText = `${med.status.toUpperCase()} (with limits)`;
        } else {
            switch(med.status) {
                case 'prohibited':
                    statusIcon = '❌';
                    statusClass = 'prohibited';
                    statusText = 'PROHIBITED';
                    break;
                case 'restricted':
                    statusIcon = '⚠️';
                    statusClass = 'restricted';
                    statusText = 'RESTRICTED';
                    break;
                case 'permitted':
                    statusIcon = '✅';
                    statusClass = 'permitted';
                    statusText = 'PERMITTED';
                    break;
                default:
                    statusIcon = '❓';
                    statusClass = 'unknown';
                    statusText = 'UNKNOWN';
            }
        }

        const cardId = `med-${med.name.replace(/\s+/g, '-').toLowerCase()}`;

        return `
        <div class="medication-card status-${med.status}">
            <!-- HANDY GUIDE LAYER -->
            <div class="handy-guide">
                <div class="guide-header">
                    <div class="medication-title">
                        <h2 class="medication-name">${med.name}</h2>
                        <div class="medication-generic">${med.genericName || ''}</div>
                    </div>
                    <div class="status-badge ${statusClass}">
                        ${statusIcon} ${statusText}
                    </div>
                </div>

                <!-- Threshold Information for Dual-Status Medications -->
                ${med.regulatoryThresholds ? `
                    <div class="threshold-info">
                        <div class="threshold-title">📊 Quantity-Based Requirements</div>
                        <div class="threshold-grid">
                            <div class="threshold-item permitted">
                                <div class="threshold-status">✅ PERMITTED</div>
                                <div class="threshold-limit">${med.regulatoryThresholds.permitted.limit}</div>
                                <div class="threshold-note">${med.regulatoryThresholds.permitted.typical_duration}</div>
                            </div>
                            <div class="threshold-item restricted">
                                <div class="threshold-status">⚠️ RESTRICTED</div>
                                <div class="threshold-trigger">${med.regulatoryThresholds.restricted.trigger}</div>
                                <div class="threshold-note">Advance permit required</div>
                            </div>
                        </div>
                    </div>
                ` : ''}

                <!-- Story Hook -->
                ${med.uniqueStory ? `
                    <div class="story-hook">
                        <div class="hook-text">${med.uniqueStory}</div>
                    </div>
                ` : ''}

                <!-- Critical Action Box -->
                <div class="critical-action">
                    <div class="action-title">🎯 What You Need to Do</div>
                    <div class="action-steps">
                        ${generateActionSteps(med)}
                    </div>
                </div>

                <!-- Customs Declaration Guidance -->
                ${med.customsDeclaration && med.customsDeclaration.legal && med.customsDeclaration.recommended ? `
                    <div class="customs-guidance">
                        <div class="guidance-title">🛂 Customs Declaration Guidance</div>
                        <div class="guidance-tabs">
                            <div class="guidance-tab legal">
                                <h5>📋 Legal Requirements</h5>
                                <div class="guidance-item">
                                    <strong>Form Declaration:</strong> ${med.customsDeclaration.legal.formDeclaration}
                                </div>
                                <div class="guidance-item">
                                    <strong>Channel:</strong> ${med.customsDeclaration.legal.channel}
                                </div>
                                <div class="guidance-item">
                                    <strong>Verbal:</strong> ${med.customsDeclaration.legal.verbalRequirement}
                                </div>
                            </div>
                            <div class="guidance-tab recommended">
                                <h5>💡 Our Recommendation</h5>
                                <div class="guidance-item">
                                    <strong>Approach:</strong> ${med.customsDeclaration.recommended.channel}
                                </div>
                                <div class="guidance-item">
                                    <strong>Phrase:</strong> "${med.customsDeclaration.recommended.verbalApproach}"
                                </div>
                                <div class="guidance-item">
                                    <strong>Why:</strong> ${med.customsDeclaration.recommended.reasoning}
                                </div>
                            </div>
                        </div>
                    </div>
                ` : ''}

                <!-- Quick Facts Grid -->
                <div class="quick-facts">
                    ${generateQuickFacts(med)}
                </div>

                ${med.consequences && med.status === 'prohibited' ? `
                    <div style="background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 6px; padding: 15px; margin-bottom: 15px;">
                        <div style="font-weight: 600; color: #721c24; margin-bottom: 8px;">🚨 Critical Warning</div>
                        <div style="color: #721c24;">${med.consequences}</div>
                    </div>
                ` : ''}

                <!-- Toggle to Encyclopedia -->
                <button class="encyclopedia-toggle" onclick="toggleEncyclopedia('${cardId}')">
                    📚 View Complete Details & Commentary
                </button>
            </div>

            <!-- ENCYCLOPEDIA LAYER -->
            <div class="encyclopedia" id="${cardId}-encyclopedia">
                <div class="encyclopedia-header">
                    📚 Complete ${med.name} Import Guide
                </div>
                ${med.uniqueStory || med.culturalContext || med.commonMisconception ? `
                    <div class="chart-section">
                        <h4>🎯 Key Insights</h4>
                        ${med.uniqueStory ? `
                            <div class="insight-box insight-key">
                                <strong>Key Insight</strong>
                                ${med.uniqueStory}
                            </div>
                        ` : ''}
                        ${med.culturalContext ? `
                            <div class="insight-box insight-cultural">
                                <strong>Cultural Context</strong>
                                ${med.culturalContext}
                            </div>
                        ` : ''}
                        ${med.commonMisconception ? `
                            <div class="insight-box insight-misconception">
                                <strong>Common Misconception</strong>
                                ${med.commonMisconception}
                            </div>
                        ` : ''}
                    </div>
                ` : ''}
                <div class="chart-section">
                    <h4>📋 Import Requirements</h4>
                    <div class="chart-grid">
                        ${generateCompleteChart(med)}
                    </div>
                </div>
                ${med.japanAvailability ? `
                    <div class="chart-section">
                        <h4>🏥 Availability in Japan</h4>
                        <div class="chart-grid">
                            ${med.japanAvailability.prescriptionRequired !== undefined ? `
                                <div class="chart-item"><div class="chart-label">Prescription Required</div>
                                <div class="chart-value">${med.japanAvailability.prescriptionRequired ? 'Yes' : 'No'}</div></div>
                            ` : ''}
                            ${med.japanAvailability.costRange ? `
                                <div class="chart-item"><div class="chart-label">Cost Range</div>
                                <div class="chart-value">${med.japanAvailability.costRange}</div></div>
                            ` : ''}
                            ${med.japanAvailability.insuranceCoverage ? `
                                <div class="chart-item"><div class="chart-label">Insurance Coverage</div>
                                <div class="chart-value">${med.japanAvailability.insuranceCoverage}</div></div>
                            ` : ''}
                            ${med.japanAvailability.availableBrands && med.japanAvailability.availableBrands.length > 0 ? `
                                <div class="chart-item"><div class="chart-label">Available Brands</div>
                                <div class="chart-value">${med.japanAvailability.availableBrands.join(', ')}</div></div>
                            ` : ''}
                            ${med.japanAvailability.restrictions ? `
                                <div class="chart-item"><div class="chart-label">Local Restrictions</div>
                                <div class="chart-value">${med.japanAvailability.restrictions}</div></div>
                            ` : ''}
                        </div>
                    </div>
                ` : ''}
                ${med.commentary ? `
                    <div class="commentary-section">
                        <div class="commentary-header">
                            💡 Commentary & Practical Insights
                        </div>
                        <div class="commentary-grid">
                            ${med.commentary.practicalTips && med.commentary.practicalTips.length > 0 ? `
                                <div class="commentary-item">
                                    <h5>🎯 Practical Tips</h5>
                                    <div>
                                        ${Array.isArray(med.commentary.practicalTips) 
                                            ? med.commentary.practicalTips.map(tip => `<p>${tip}</p>`).join('') 
                                            : `<p>${med.commentary.practicalTips}</p>`
                                        }
                                    </div>
                                </div>
                            ` : ''}
                            ${med.commentary.commonMistakes && med.commentary.commonMistakes.length > 0 ? `
                                <div class="commentary-item">
                                    <h5>❌ Common Mistakes</h5>
                                    <div>
                                        ${Array.isArray(med.commentary.commonMistakes) 
                                            ? med.commentary.commonMistakes.map(mistake => `<p>${mistake}</p>`).join('') 
                                            : `<p>${med.commentary.commonMistakes}</p>`
                                        }
                                    </div>
                                </div>
                            ` : ''}
                            ${med.commentary.realWorldInsights && med.commentary.realWorldInsights.length > 0 ? `
                                <div class="commentary-item">
                                    <h5>🌍 Real-World Insights</h5>
                                    <div>
                                        ${Array.isArray(med.commentary.realWorldInsights) 
                                            ? med.commentary.realWorldInsights.map(insight => `<p>${insight}</p>`).join('') 
                                            : `<p>${med.commentary.realWorldInsights}</p>`
                                        }
                                    </div>
                                </div>
                            ` : ''}
                            ${med.commentary.proTips && med.commentary.proTips.length > 0 ? `
                                <div class="commentary-item">
                                    <h5>✨ Pro Tips</h5>
                                    <div>
                                        ${Array.isArray(med.commentary.proTips) 
                                            ? med.commentary.proTips.map(tip => `<p>${tip}</p>`).join('') 
                                            : `<p>${med.commentary.proTips}</p>`
                                        }
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                ` : ''}
                ${med.alternatives && med.alternatives.length > 0 ? `
                    <div class="chart-section">
                        <h4>🔄 Alternatives</h4>
                        <div class="alternatives-section">
                            ${med.alternatives.map(alt => `<p>${alt}</p>`).join('')}
                        </div>
                    </div>
                ` : ''}
                ${med.researchQuality ? `
                    <div class="chart-section research-quality-section">
                        <h4>📊 Research Quality</h4>
                        <div class="chart-grid">
                            ${med.researchQuality.primarySources && med.researchQuality.primarySources.length > 0 ? `
                                <div class="chart-item">
                                    <div class="chart-label">Primary Sources</div>
                                    <div class="chart-value">${med.researchQuality.primarySources.length} official sources</div>
                                </div>
                            ` : ''}
                            ${med.researchQuality.confidenceLevel ? `
                                <div class="chart-item">
                                    <div class="chart-label">Confidence Level</div>
                                    <div class="chart-value">${med.researchQuality.confidenceLevel}</div>
                                </div>
                            ` : ''}
                            ${med.researchQuality.lastUpdated ? `
                                <div class="chart-item">
                                    <div class="chart-label">Last Updated</div>
                                    <div class="chart-value">${med.researchQuality.lastUpdated}</div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                ` : ''}
                <button class="encyclopedia-toggle" onclick="toggleEncyclopedia('${cardId}')" style="margin-top: 30px;">
                    ↑ Hide Complete Details
                </button>
            </div>
        </div>
        `;
    }).join('');
}

// --- ACTION STEPS ---
function generateActionSteps(med) {
    switch(med.status) {
        case 'prohibited':
            return `
                <div class="step-item">
                    <div class="step-number">❌</div>
                    <div class="step-content">
                        <strong>DO NOT BRING:</strong> This medication is illegal in Japan.
                        ${med.alternatives ? `Consider alternatives: ${med.alternatives[0]}` : 'Consult your doctor about legal alternatives before travel.'}
                    </div>
                </div>
            `;
        case 'restricted':
            if (med.permitRequired && med.permitRequired.toUpperCase().includes('YES')) {
                return `
                    <div class="step-item">
                        <div class="step-number">1</div>
                        <div class="step-content">Apply for import permit 4-6 weeks before travel</div>
                    </div>
                    <div class="step-item">
                        <div class="step-number">2</div>
                        <div class="step-content">At airport: Red Channel, present permit + prescription</div>
                    </div>
                `;
            } else {
                return `
                    <div class="step-item">
                        <div class="step-number">1</div>
                        <div class="step-content">Pack in original containers with prescription</div>
                    </div>
                    <div class="step-item">
                        <div class="step-number">2</div>
                        <div class="step-content">At airport: Red Channel - must declare at customs</div>
                    </div>
                `;
            }
        default:
            return `
                <div class="step-item">
                    <div class="step-number">✓</div>
                    <div class="step-content">
                        Keep in original packaging with prescription. Green Channel - no special procedures required.
                    </div>
                </div>
            `;
    }
}

// --- QUICK FACTS ---
function generateQuickFacts(med) {
    let facts = [];
    if (med.maxQuantity) facts.push(`
        <div class="fact-item">
            <div class="fact-label">Max Quantity</div>
            <div class="fact-value">${med.maxQuantity}</div>
        </div>
    `);
    facts.push(`
        <div class="fact-item">
            <div class="fact-label">Customs Declaration</div>
            <div class="fact-value">${typeof med.customsDeclaration === 'object' ? med.customsDeclaration.legal.formDeclaration : med.customsDeclaration}</div>
        </div>
    `);
    facts.push(`
        <div class="fact-item">
            <div class="fact-label">Airport Channel</div>
            <div class="fact-value">${med.channelRequired}</div>
        </div>
    `);
    return facts.join('');
}

// --- IMPORT REQUIREMENTS CHART ---
function generateCompleteChart(med) {
    let chartItems = [];
    if (med.maxQuantity) chartItems.push(`
        <div class="chart-item">
            <div class="chart-label">Max Quantity</div>
            <div class="chart-value">${med.maxQuantity}</div>
        </div>
    `);
    if (med.permitRequired) chartItems.push(`
        <div class="chart-item">
            <div class="chart-label">Import Permit</div>
            <div class="chart-value">${med.permitRequired}</div>
        </div>
    `);
    if (med.conditions) chartItems.push(`
        <div class="chart-item">
            <div class="chart-label">Conditions</div>
            <div class="chart-value">${med.conditions}</div>
        </div>
    `);
    chartItems.push(`
        <div class="chart-item">
            <div class="chart-label">Customs Declaration</div>
            <div class="chart-value">${typeof med.customsDeclaration === 'object' ? med.customsDeclaration.legal.formDeclaration : med.customsDeclaration}</div>
        </div>
    `);
    chartItems.push(`
        <div class="chart-item">
            <div class="chart-label">Airport Channel</div>
            <div class="chart-value">${med.channelRequired}</div>
        </div>
    `);
    if (med.consequences) chartItems.push(`
        <div class="chart-item">
            <div class="chart-label">Consequences</div>
            <div class="chart-value">${med.consequences}</div>
        </div>
    `);
    return chartItems.join('');
}

// --- TOGGLE DETAILS ---
function toggleEncyclopedia(cardId) {
    const encyclopedia = document.getElementById(`${cardId}-encyclopedia`);
    const buttons = document.querySelectorAll(`[onclick="toggleEncyclopedia('${cardId}')"]`);

    if (encyclopedia.classList.contains('expanded')) {
        encyclopedia.classList.remove('expanded');
        buttons.forEach(button => {
            button.textContent = '📚 View Complete Details & Commentary';
        });
    } else {
        encyclopedia.classList.add('expanded');
        buttons.forEach(button => {
            button.textContent = '↑ Hide Complete Details';
        });
        encyclopedia.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
}

// --- CLASSIFICATION MODAL FUNCTIONS ---
function openClassificationModal() {
    document.getElementById('classificationModal').style.display = 'block';
}

function closeClassificationModal() {
    document.getElementById('classificationModal').style.display = 'none';
}

// Close modal when clicking outside of it
window.onclick = function(event) {
    const modal = document.getElementById('classificationModal');
    if (event.target == modal) {
        modal.style.display = 'none';
    }
}

// --- INITIALIZE ---
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('categoryOverview').style.display = 'grid';
    document.getElementById('searchResults').style.display = 'none';
    document.getElementById('noResults').style.display = 'none';
});
 
</script>

<!-- Classification Modal -->
<div id="classificationModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeClassificationModal()">&times;</span>
        <h2 style="margin-bottom: 25px; color: #1976d2;">🏥 Understanding Our Classification System</h2>
        
        <p style="margin-bottom: 25px; line-height: 1.6; color: #555;">
            Japan has a two-agency system for medication imports: the <strong>Ministry of Health, Labour and Welfare (MHLW)</strong> determines if you need permits, while <strong>Japan Customs</strong> handles declaration requirements at the border. Our classification reflects both agencies' requirements to give you clear, actionable guidance.
        </p>

        <div class="classification-item classification-prohibited">
            <div class="classification-title">❌ PROHIBITED</div>
            <div class="classification-description">
                These substances are illegal to bring into Japan under any circumstances. Possession can result in arrest, detention, and deportation.
            </div>
            <div class="classification-example">
                <strong>Examples:</strong> Adderall (amphetamine), Sudafed (pseudoephedrine)
            </div>
        </div>

        <div class="classification-item classification-restricted">
            <div class="classification-title">⚠️ RESTRICTED</div>
            <div class="classification-description">
                These medications require specific action at customs. You <strong>must</strong> use the Red Channel and declare them, even if no advance permit is needed. This includes all psychotropic substances.
            </div>
            <div class="classification-example">
                <strong>Examples:</strong> Xanax (alprazolam), Clonazepam, Vyvanse (requires permit)
            </div>
        </div>

        <div class="classification-item classification-permitted">
            <div class="classification-title">✅ PERMITTED</div>
            <div class="classification-description">
                These medications can be brought through the Green Channel with standard documentation (prescription bottle, doctor's letter recommended). No special permits or declarations required.
            </div>
            <div class="classification-example">
                <strong>Examples:</strong> Birth control pills, Tramadol, most antibiotics
            </div>
        </div>

        <div style="margin-top: 30px; padding: 20px; background: #e3f2fd; border-radius: 8px; border-left: 4px solid #1976d2;">
            <h3 style="margin-bottom: 15px; color: #1976d2;">🎯 Key Insight</h3>
            <p style="line-height: 1.6; margin: 0;">
                A medication can be "permitted" by MHLW (no advance permit needed) but still "restricted" in our system because Customs requires mandatory declaration. This prevents the confusion that causes problems for travelers who assume "permitted" means "no customs action needed."
            </p>
        </div>

        <div style="margin-top: 20px; text-align: center;">
            <p style="font-style: italic; color: #666; font-size: 0.9rem;">
                Our classifications are based on direct correspondence with Japanese authorities and official government guidance.
            </p>
        </div>
    </div>
</div>

</body>
</html>
